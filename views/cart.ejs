<%- include('./partials/header') %>
<% if(removed.length > 0) { %>
  <div id = "flash-message" class ="mt-5 absolute top-5 left-1/2 -translate-x-1/2 -translate-y-1/2 p-3 rounded-md bg-blue-500 z-50">
    <span class="inline-block mt-1 mb-1 text-white"><%= removed %></span>
  </div>
<% } %>
<div class="min-h-screen w-full px-10 py-16 bg-[url('/images/image.png')] bg-cover bg-center text-white font-sans space-y-12">

  <!-- Cart Header -->
  <div class="border-b border-yellow-400/30 pb-6">
    <h2 class="text-4xl font-bold tracking-wide text-yellow-400">Your Cart</h2>
    <p class="text-gray-400 mt-2">Review your selected bags before checking out.</p>
  </div>

  <!-- Cart Items Section -->
  <div class="grid grid-cols-1 lg:grid-cols-3 gap-12">

    <!-- Cart List -->
    <div class="lg:col-span-2 space-y-8">
      <% cartItems.forEach(item => {
        let originalPrice = item.price;
        let discountedPrice = (item.discount > 0 && item.discount < item.price)
          ? item.discount
          : item.price;
      %>
        <div class="flex items-center justify-between p-6 rounded-2xl shadow-md <%= item.panelcolor %>">
          <div class="flex items-center gap-6">
            <img 
              src="data:image/png;base64,<%= item.image.toString('base64') %>" 
              alt="<%= item.name %>" 
              class="w-24 h-24 object-cover rounded-xl border border-yellow-400/20"
            >
            <div>
              <h3 class="text-xl font-semibold <%= item.textcolor %>">
                <%= item.name %>
              </h3>

              <% if (item.discount > 0 && item.discount < item.price) { %>
                <div class="mt-1 space-x-2">
                  <span class="text-gray-400 line-through">₹<%= originalPrice %></span>
                  <span class="text-yellow-400 font-semibold">₹<%= discountedPrice %></span>
                  <span class="text-green-400 text-sm">(You save ₹<%= originalPrice - discountedPrice %>)</span>
                </div>
              <% } else { %>
                <p class="text-yellow-400 mt-2 font-medium">₹<%= originalPrice %></p>
              <% } %>
            </div>
          </div>

          <div class="text-right">
            <form action="/remove-from-cart/<%= item._id %>" method="POST">
              <button class="text-red-500 hover:underline text-sm">Remove</button>
            </form>
          </div>
        </div>
      <% }) %>
    </div>

    <!-- Order Summary -->
    <div class="bg-[#1e1e1e] p-6 rounded-2xl shadow-md h-fit">
      <h3 class="text-2xl font-bold text-yellow-300 border-b border-yellow-400/20 pb-4 mb-4">Order Summary</h3>
      
      <%
        let subtotal = 0;
        cartItems.forEach(item => {
          let price = (item.discount > 0 && item.discount < item.price)
            ? item.discount
            : item.price;
          subtotal += price;
        });
        let shipping = 199;
        let total = subtotal + shipping;
      %>

      <div class="space-y-2 text-sm">
        <% cartItems.forEach(item => { 
          let price = (item.discount > 0 && item.discount < item.price)
            ? item.discount
            : item.price;
        %>
          <div class="flex justify-between">
            <span><%= item.name %></span>
            <span>₹<%= price %></span>
          </div>
        <% }) %>
      </div>

      <div class="flex justify-between mt-4">
        <span class="text-gray-400">Subtotal</span>
        <span class="text-white">₹<%= subtotal %></span>
      </div>
      <div class="flex justify-between">
        <span class="text-gray-400">Shipping</span>
        <span class="text-white">₹<%= shipping %></span>
      </div>
      <div class="flex justify-between font-semibold text-yellow-300 text-lg mt-4 border-t border-yellow-400/20 pt-4">
        <span>Total</span>
        <span>₹<%= total %></span>
      </div>

      <form action="/checkout" method="POST">
        <button class="mt-6 w-full bg-yellow-400 text-black py-3 rounded-xl font-semibold hover:bg-yellow-300 transition duration-200">
          Proceed to Checkout
        </button>
      </form>
    </div>
  </div>
</div>
<script>
  setTimeout(() => {
    const flash = document.getElementById("flash-message");
    if (flash) flash.remove();
  }, 500);
</script>

<%- include('./partials/footer') %>
